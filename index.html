<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App-Weiterleitung</title>
  <meta name="robots" content="noindex, nofollow">
  <style>
    html,body{height:100%;margin:0}
    body{font-family:system-ui,Arial,sans-serif;background:#0b0b0b;color:#fff;display:flex;align-items:center;justify-content:center}
    .card{max-width:640px;padding:24px;text-align:center}
    a.btn,button.btn{display:inline-block;margin-top:12px;padding:12px 16px;border-radius:10px;background:#1f6feb;color:#fff;border:0;font-weight:600;text-decoration:none}
    p{opacity:.9}
    code{background:#111;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Starte App …</h1>
    <p id="status">Bitte einen Moment.</p>
    <button id="openBtn" class="btn" style="display:none">App öffnen</button>
    <p id="fallback" style="display:none">Falls es nicht klappt, öffne den Link manuell oder halte ihn gedrückt und wähle <code>In Chrome/Safari öffnen</code>.</p>
  </div>

  <script>
    const TARGET_TXT = "target.txt";

    // einfache Erkennung „guter“ Browser (Chrome/Safari) vs. eingebettete WebViews (Google-App, Facebook, Instagram, Drive)
    const ua = navigator.userAgent || "";
    const isIOS = /iPad|iPhone|iPod/.test(ua);
    const isSafari = isIOS ? /Safari/.test(ua) && !/CriOS|FxiOS/.test(ua) : /Safari/.test(ua) && !/Chrome/.test(ua);
    const isChrome = /Chrome|CriOS/i.test(ua) && !/Edg|OPR/i.test(ua);
    const looksLikeWebView =
      /FBAN|FBAV|Instagram|GSA|GoogleApp|Line|WeChat|MiuiBrowser|wv/.test(ua) ||
      (isIOS && !/Safari/.test(ua) && /AppleWebKit/.test(ua)); // iOS WebView

    function setStatus(msg){ document.getElementById('status').textContent = msg; }

    async function getTarget() {
      const resp = await fetch(TARGET_TXT, { cache: "no-store" });
      if (!resp.ok) throw new Error("target.txt nicht gefunden");
      const url = (await resp.text()).trim();
      try { new URL(url); } catch { throw new Error("Ungültige URL in target.txt"); }
      return url;
    }

    async function start() {
      try {
        const url = await getTarget();

        // Button immer anbieten
        const btn = document.getElementById('openBtn');
        btn.style.display = 'inline-block';
        btn.onclick = () => { window.location.href = url; };

        if (!looksLikeWebView && (isChrome || isSafari)) {
          // In „echten“ Browsern direkt weiterleiten
          setStatus("Leite weiter …");
          // replace vermeidet Zurück-Navigation auf diese Seite
          window.location.replace(url);
        } else {
          // In WebViews: Nutzer-Tap erzwingen (Button)
          setStatus("Tippe auf „App öffnen“, um fortzufahren.");
          document.getElementById('fallback').style.display = 'block';
        }
      } catch (e) {
        setStatus("Fehler: " + e.message);
      }
    }
    start();
  </script>
</body>
</html>
