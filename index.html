<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App öffnen</title>
  <meta name="robots" content="noindex, nofollow">
  <style>
    html,body{height:100%;margin:0}
    body{font-family:system-ui,Arial,sans-serif;background:#0b0b0b;color:#fff;display:flex;align-items:center;justify-content:center}
    .card{max-width:680px;padding:24px;text-align:center}
    .btn{display:inline-block;margin:8px 6px;padding:12px 16px;border-radius:10px;background:#1f6feb;color:#fff;border:0;font-weight:600;text-decoration:none}
    p{opacity:.9}
    code{background:#111;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="card">
    <h1>App starten</h1>
    <p id="status">Tippe auf einen der Buttons unten.</p>

    <a id="openBtn" class="btn" href="#">In Browser öffnen</a>
    <a id="chromeIntent" class="btn" href="#" style="display:none">In Chrome öffnen (Android)</a>

    <p id="fallback" style="margin-top:14px;opacity:.8">
      Falls sich eine Google-/Drive-Seite meldet:
      <br>• Halte den Link gedrückt → <code>In Chrome/Safari öffnen</code> wählen.<br>
      • Oder kopiere den Link in die Adresszeile.
    </p>
  </div>

  <script>
    const TARGET_TXT = "target.txt";

    async function getTarget() {
      const resp = await fetch(TARGET_TXT, { cache: "no-store" });
      if (!resp.ok) throw new Error("target.txt nicht gefunden");
      const url = (await resp.text()).trim();
      try { new URL(url); } catch { throw new Error("Ungültige URL in target.txt"); }
      return url;
    }

    (async () => {
      try {
        const url = await getTarget();
        const ua = navigator.userAgent || "";
        const isAndroid = /Android/i.test(ua);

        // Normaler Öffnen-Button -> gibt dem WebView einen echten User-Tap (öffnet meist externen Browser)
        const openBtn = document.getElementById('openBtn');
        openBtn.href = url;
        openBtn.onclick = (e) => {
          e.preventDefault();
          // Versuche zuerst neuen Tab/Fenster:
          const w = window.open(url, '_blank', 'noopener');
          if (!w) {
            // Fallback: same-window
            window.location.href = url;
          }
        };

        // Android: Chrome-Intent-Link anbieten, der WebViews zuverlässig verlässt
        if (isAndroid) {
          const u = new URL(url);
          const intent = `intent://${u.host}${u.pathname}${u.search}#Intent;scheme=${u.protocol.replace(':','')};package=com.android.chrome;end`;
          const ci = document.getElementById('chromeIntent');
          ci.style.display = 'inline-block';
          ci.href = intent;
        }
      } catch (e) {
        document.getElementById('status').textContent = "Fehler: " + e.message;
      }
    })();
  </script>
</body>
</html>
